<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>爱心伞跳转页</title>
</head>

<body>

    <script>
        function getCookie(name) {
            var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
            if (arr = document.cookie.match(reg))
                return unescape(arr[2]);
            else
                return null;
        }
        var cookieValue = getCookie('token');
        if (cookieValue) {
            fetch('自动登录接口', {
                method: "POST",
                body: JSON.stringify({ token: cookieValue }),
                headers: {
                    "Content-Type": "application/json"
                },
            })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        return Promise.reject('QAQ出错啦');
                    }
                })
                .then(data => {
                    console.log(data);
                    if (data.login) {
                        oError.innerHTML = "自动登录成功";
                        setCookies({
                            name: '登录token',
                            token: data.list.token,
                        }, 7);
                        if (!href.indexOf('/zhuye/')) {
                            window.location.href = '/zhuye/';
                        }
                    } else {
                        if (!href.indexOf('/login/')) {
                            window.location.href = '/login/';
                        }
                    }
                });
        } else {
            var href = location.href;
            if (!href.indexOf('/login/')) {
                window.location.href = '/login/';
            }
        }
    </script>
</body>

</html>