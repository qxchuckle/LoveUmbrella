<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>爱心伞主页</title>
</head>

<body>
    <p id="loding" style="text-align: center;"><img src='../loding.gif'>自动登录中</p>
    <div class="layout">
        <h1 style="text-align: center;">爱心伞主页</h1>
        <h1 style="text-align: center;">一个借伞区域，一个还伞区域，当然还有个统计区域</h1>
        <button class="btn1">退出登陆</button>

    </div>

    <script>
        const btn1 = document.querySelector(".btn1");
        var oLoding = document.getElementById("loding");
        const layout = document.querySelector(".layout");
        layout.style.display = "none";
        function clearCookie() {
            var keys = document.cookie.match(/[^ =;]+(?=\=)/g);
            if (keys) {
                for (var i = keys.length; i--;) {
                    document.cookie = keys[i] + '=0;path=/;expires=' + new Date(0).toUTCString();//清除当前域名下的,例如：m.kevis.com
                    document.cookie = keys[i] + '=0;path=/;domain=' + document.domain + ';expires=' + new Date(0).toUTCString();//清除当前域名下的，例如 .m.kevis.com
                    document.cookie = keys[i] + '=0;path=/;domain=kevis.com;expires=' + new Date(0).toUTCString();//清除一级域名下的或指定的，例如 .kevis.com
                }
            }
            console.log('已清除');
        }
        function getCookie(name) {
            var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
            if (arr = document.cookie.match(reg))
                return unescape(arr[2]);
            else
                return null;
        }
        var cookieValue = getCookie('token');
        if (cookieValue) {
            fetch('https://mock.apifox.cn/m1/1703731-0-default/automaticLogon', {
                method: "POST",
                body: JSON.stringify({ token: cookieValue }),
                headers: {
                    "Content-Type": "application/json"
                },
            })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        return Promise.reject('QAQ出错啦');
                    }
                })
                .then(data => {
                    if (data.list.login) {
                        layout.style.display = "block";
                        loding.style.display = "none";
                    } else {
                        alert("你还未登录！！");
                        window.location.href = '/';
                    }
                });
        } else {
            alert("你还未登录！！");
            window.location.href = '/';
        }
        btn1.addEventListener("click", function () {
            clearCookie() 
            window.location.href = '/';
        });
    </script>
</body>

</html>