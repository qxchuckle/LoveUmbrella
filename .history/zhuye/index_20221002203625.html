<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>爱心伞主页</title>
</head>

<body>
    <p id="loding" style="text-align: center;"><img src='../loding.gif'>自动登录中</p>
    <div class="layout">
        <h1 style="text-align: center;">爱心伞主页</h1>
        <h1 style="text-align: center;">一个借伞区域，一个还伞区域，当然还有个统计区域</h1>
        <button class="btn1">退出登陆</button>

    </div>

    <script>
        const btn1 = document.querySelector(".btn1");
        var oLoding = document.getElementById("loding");
        const layout = document.querySelector(".layout");
        layout.style.display = "none";
        function getCookie(name) {
            var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
            if (arr = document.cookie.match(reg))
                return unescape(arr[2]);
            else
                return null;
        }
        var cookieValue = getCookie('token');
        if (cookieValue) {
            fetch('https://mock.apifox.cn/m1/1703731-0-default/automaticLogon', {
                method: "POST",
                body: JSON.stringify({ token: cookieValue }),
                headers: {
                    "Content-Type": "application/json"
                },
            })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        return Promise.reject('QAQ出错啦');
                    }
                })
                .then(data => {
                    if (data.list.login) {
                        layout.style.display = "block";
                        loding.style.display = "none";
                    } else {
                        alert("你还未登录！！");
                        window.location.href = '/';
                    }
                });
        } else {
            alert("你还未登录！！");
            window.location.href = '/';
        }
        btn1.addEventListener("click", function () {
            window.location.href = '/';
            let data = new Date().getTime()   //先将此时的时间转化为毫秒
            let old_data = new Date(data - 24 * 60 * 60 * 1000) //将过时时间设为24小时前
            document.cookie = 'name=张三;' + 'expires=' + old_data.toUTCString()
        });
    </script>
</body>

</html>